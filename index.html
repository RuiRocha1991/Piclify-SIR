<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <title>Teste</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script>
</head>
<body>
    <form id="form" method="POST" enctype="multipart/form-data"  >
        <label>Name: <input type="text" name="name"></label><br>
        <label>Email: <input type="Email" name="email"></label><br>
        <label>Password: <input type="password" name="password"></label><br>
        <label>Genre: <input type="text" name="genre"></label><br>
        <label>Locality: <input type="text" name="locality"></label><br>
        <label>Country: <input type="text" name="country"></label><br>
        <label>Birth_date: <input type="date" name="birth_date"></label><br>
    </form>
    <input  id="button" type="submit" value="Enviar">
  
<br><br><br>


    <form action="php/upload-files/upload-profile.php" method="POST" enctype="multipart/form-data">
        <input type="file" name="profile"><br>
        <label>Email: <input type="number" name="number"></label><br>
        <input type="submit">
        <input type="reset" >
    </form>

    <br><br><br>
    <br><br><br>
    <form id="form2" method="POST" enctype="multipart/form-data"  >
        <label>Email: <input type="Email" name="email"></label><br>
    </form>    
    <input  id="button2" type="submit" value="Enviar"> 

        <label>Name: <label id="name"> </label></label><br>
        <label>Password: <label id="pass"> </label></label><br>
        <label>Genre: <label id="genre"> </label></label><br>
        <label>Locality: <label id="locality"> </label></label><br>
        <label>Country: <label id="contry"> </label></label><br>
        <label>Birth_date: <label id="date"> </label></label><br>
        <label>Photo: <img id="photo"></label><br>
    
   

<script>

    var totUser=0;

    $("#button").click(function() {
       var data = getFormData($("#form"));
       $.ajax({
            url:'http://localhost:3000/user',
            type: "get",
            data: data ,
            dataType:'json',
            success: function (res) {
                console.log(res);
                res.length==0?createNewUser():null;
            },
            error: function (errorMessage) {
                alert(errorMessage);
            }
        });
    });

    function getFormData(form){
        var unindexed_array = form.serializeArray();
        var indexed_array = {};

        $.map(unindexed_array, function(n, i){
            indexed_array[n['name']] = n['value'];
        });

        return indexed_array;
    }

    function createNewUser(){
        console.log('vai criar');
        var data=getFormData($("#form"));
        $.ajax({
            url:'http://localhost:3000/user',
            type: "POST",
            data: data,
            dataType:'json',
            success: function (res) {
                console.log(res);
            },
            error: function (errorMessage) {
                alert(errorMessage);
            }
        });
    }

    $("#button2").click(function() {
       var data = getFormData($("#form2"));
       var value ;
       $.ajax({
            url:'http://localhost:3000/user',
            type: "get",
            data: data ,
            dataType:'json',
            success: function (res) {
               fill(res);
            },
            error: function (errorMessage) {
                alert(errorMessage);
            }
        });
    });

    function fill(data){
        console.log(data);
        $('#name').text(data[0].name);
        $('#pass').text(data[0].password);
        $('#genre').text(data[0].genre);
        $('#locality').text(data[0].locality);
        $('#contry').text(data[0].country);
        $('#date').text(data[0].birth_date);
        var img ='upload/profile/'+data[0].profile_photo;
        console.log(img);
        $('#photo').attr('src','./upload/profile/'+data[0].profile_photo+'.png');
    }
      
</script>

</body>
</html>